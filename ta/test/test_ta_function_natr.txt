use ta;

#include "setup/settings.txt"
timePeriod=10
tickTB=loadText(DATA_DIR+"/ticks1.csv")
nan=double()
@testing:case="test_ta_function_trange_use_tick1"
a1 = exec ta::natr(high, low, close, 2) from tickTB where sym=`tick1
b1 = [NULL,NULL,6.13425926,5.42977744,7.82653061,8.26687685,8.53906791,6.53649357]
assert 1, eqObj(a1,b1,5)

a2 = exec ta::natr(high, low, close,2) from tickTB where sym=`tick2
b2 = [        nan,         nan,         nan,         nan,         nan,
               nan,         nan,         nan,  6.82374541,  7.72058824,
       34.93932039, 22.53882766, 15.92497363, 13.10511057, 23.73494105,
       17.06781192, 14.82345627, 10.09384498,  9.31082333,  9.27949793,
        6.30257119,  8.89266664,  8.81358779,  9.19367185,  7.71071007,
        9.92209533,  7.97520797,  6.24207774,  9.18466151, 10.30247189,
        7.41946302,  9.67747946,  7.79333049,  8.7145084 ,  7.34129223,
        8.05764366, 10.15774413,  7.52489198,  7.07673683,  6.34274369,
        7.45197035,  6.06877336,  9.31425755,  9.29071341,  8.39026153,
        8.16477661,  9.27005075,  7.29151853,  5.161422  ,  7.56012986,
        6.58668654,  6.69721405,  5.59761273,  4.12573706,  7.66828255,
        6.46077294,  5.72071862,  4.6954794 ,  4.97162775,  4.33390185,
        6.61878221,  5.37861372,  4.62166502,  4.1748814 ,  5.64709836,
        4.54946395,  4.53650009,  4.67901281,  3.8711529 ,  4.07267146,
        5.55766935,  4.53179417,  4.69767405,  3.45065894,  3.22281532,
        3.56987673,  4.27580369,  3.43264288,  3.38774456,  7.78095255,
        7.62783202,  6.45883377,  4.47791619,  4.62702429,  3.94758388,
        2.98761548,  3.53869938,  4.49842398,  3.17274283,  5.02985063,
        4.91896533,  5.65167006,  5.43064352,  5.21387297,  4.51940552,
        4.29069089,  3.45068124,  3.77649968,  3.32754661,  2.94696738]
assert 1, eqObj(a2,b2,5)


a3 = exec ta::natr(high, low, close,2) from tickTB where sym=`tick3
b3 = [NULL,NULL,3.73134328,4.6234881,7.66112266]
assert 1, eqObj(a3,b3,5)

a4 = exec ta::natr(high, low, close,2) from tickTB where sym=`tick4
b4 = [NULL,NULL,6.77039529,6.12118714,8.29295154,6.40679066,4.51204686,4.59960938,5.98805147,5.18172696,4.28988795,8.27763183,6.09283581,8.7615035,10.43587257,9.27725546,7.2792308,9.61258568,9.11819228,8.70223737,9.86910962,10.44780742,9.29445792,8.14037726,8.4758919,6.13644367,4.78459602,4.3093406,3.58580634,4.8434412,5.75312298,7.14806175,7.85281042,7.79814579,4.83475613,4.23988877,3.59544048,4.58710187,3.84551072,4.16692525,5.73849728,5.33393694,6.02022614,5.07506833,4.81572532,7.154561,5.61029753,9.05504082,12.1919503,9.4451495,12.03170634,7.88016272,8.65032331,9.8042057,8.98952555,10.75313136,10.49907073,8.78147207,10.55689075,12.63444162,10.88877312,9.54231787,6.93522936,8.40936035,6.10828066,5.11143124,8.38660123,7.51028869,6.78653136,7.25025976,8.57211095,10.41680839,9.49396674,8.32492583,8.34792286,8.71721453,6.42736349,5.56207766,6.00644076,5.93010673,4.74564678,5.21174294,7.11497609,6.55569228,6.52195559,6.19874267,5.0833881,4.5660463,5.41350245,4.40163077,8.39784775,9.80857215,7.97961798,7.60539937,8.01707572,8.85802907,6.56262196,6.43672079,8.02329736,6.47263269]
assert 4, eqObj(a4,b4,5)

a5 = exec ta::natr(high, low, close,2) from tickTB where sym=`tick5
b5 = [NULL,NULL,6.46425073,6.01719198,7.74719674,6.67330677,5.14631685,5.13347023,4.89186406,4.57042957,3.89260021,5.73717949,5.05642361,7.74781051,9.84577683,9.67788869,8.40373411,5.95593767,8.84244549,6.65202815,6.20742318,5.25081992,8.83442636,8.56142944,7.14805476,6.91801782,4.85294612,4.35332521,3.94257424,3.24989247,4.15579661,4.84735071,5.15062086,7.32048113,6.83125387,5.01320835,4.15031594,3.30865103,4.06338427,3.49661924,3.53418654,4.11811174,4.43543985,4.64087841,4.59334997,6.07300095,7.58918362,6.0012683,8.87425127,11.4409793,8.94264628,10.02845268,8.23069624,7.72739589,7.53841895,6.05145778,6.71692002,6.7886094,5.97571824,8.50473629,8.59010129,6.11671133,7.42419908,6.08868034,8.40358961,7.07105858,6.17231716,8.01158695,6.16822177,4.91734595,8.972733,9.42529177,10.0077603,10.49941033,8.19890695,8.29950348,7.05534221,5.76057531,4.3954145,3.73195848,4.36915194,4.63492652,6.31670754,6.31212949,5.97091724,5.66869541,7.13454466,7.78287524,9.64381627,8.63330452,8.61423284,8.86814849,9.48872445,9.86518127,10.35198521,9.71256457,6.82295732,7.46721635,7.0658093,6.77888505]
assert 5, eqObj(a5,b5,5)


a6 = (exec ta::natr(high, low, close, 2) from tickTB context by sym).values()[0]
b6 = b1.join(b2).join(b3).join(b4).join(b5)
assert 6, eqObj(a6,b6,5)
