#include "setup/settings.txt"
use ta
//cmo(real, timePeriod)

precision=5
nan=double()
@testing:case="test_ta_function_cmo_5"
high = [4.87661076, 5.09258627, 4.69128548, 4.51989263, 0.85037274]

assert 1, eqObj(cmo(high, 2), [  , , -30.02306747, -55.00800782,
       -97.23783662], precision)

@testing:case="test_ta_function_cmo_context_by"
tick = loadText(DATA_DIR + "/ticks1.csv")
res = select sym, cmo(close, 10) result from tick context by sym

tick1 = exec result from res where sym = `tick1
validate1=[nan, nan, nan, nan, nan, nan, nan, nan]
assert 1, eqObj(tick1, validate1, precision)

tick2 = exec result from res where sym = `tick2
validate2=[         nan,          nan,          nan,          nan,
                nan,          nan,          nan,          nan,
                nan,          nan,          nan,          nan,
                nan,          nan,          nan,          nan,
        13.67521368,   9.15841584,  10.96277169,   2.70560118,
         2.12611096,   9.04974757,  -0.0960935 ,  -8.29642057,
        -3.81164044,   9.67308382,   8.49331661,   6.75337788,
         9.96218351,  17.72217201,   8.84809343, -10.44079455,
       -10.54951508, -22.74190045, -21.63972413, -27.52768198,
       -31.5387165 , -31.64380607, -19.79340681, -12.60828527,
       -10.03185289, -17.45693035, -34.1326867 , -43.17250528,
       -31.17098442, -31.99208786, -38.51230427, -32.70611994,
       -31.63981998, -18.9014376 , -27.65249573, -11.55321117,
       -12.68267691, -12.41683187,   1.52299845,  10.2270046 ,
        10.91767535,   9.97754761,  17.72585722,  15.15618534,
        41.22277889,  44.89669529,  31.39133567,  33.44063453,
        42.31653908,  45.18320391,  32.57551164,  33.19927157,
        30.95574809,  37.50538035,  22.31145712,  15.43968271,
        29.47312138,  34.66975146,  21.96158115,  27.65095563,
        35.82061162,  32.79135835,  27.5242888 , -23.22766311,
       -38.02621202, -23.93497318, -23.60889153, -34.02412243,
       -26.56767568, -30.26276042, -29.45852579, -39.4305801 ,
       -41.1633729 , -52.14874743, -52.45225613, -56.722257  ,
       -31.82405218, -15.30997493, -24.58642507, -15.00941   ,
       -20.24914058, -12.54005734, -10.1854221 , -15.73570668]
assert 2, eqObj(tick2,validate2, precision)

tick3 = exec result from res where sym = `tick3
validate3=[nan, nan, nan, nan, nan]
assert 1, eqObj(tick3, validate3, 3)

tick4 = exec result from res where sym = `tick4
validate4=[         nan,          nan,          nan,          nan,
                nan,          nan,          nan,          nan,
                nan,          nan,  19.16167665,  -1.48514851,
        -0.25963048, -24.3627835 , -41.67279128, -15.40210094,
       -18.78436803, -34.42315032, -31.39148995,  -8.42111427,
       -22.77650067, -29.78444326, -10.55037079,  -4.12089925,
         4.48303298,   4.86281902,   0.21409179,   6.7741591 ,
         8.9901288 ,  13.33886412,  14.53298125,   2.87745297,
        -8.32856201,  -5.45681837,   0.71689715,  -3.25752749,
        -0.32496564,  14.51216609,  16.07922469,  27.3283113 ,
        28.99803002,   8.26812015,  -9.35555867,  -1.48881734,
        -6.13339945, -25.61675397, -25.17262802, -45.97237403,
       -56.85131271, -34.63604703, -13.45322908, -14.52059499,
       -17.67914566, -20.25173085,   6.35310543, -16.28428746,
       -10.72933294, -13.99022727, -27.85087685, -39.83729378,
       -42.65134041, -30.38917281, -26.26357655, -36.55770265,
       -32.11735595, -25.82305438, -39.22730192, -31.81660363,
       -36.13336645, -40.81703635, -48.84487244, -49.4311443 ,
       -49.90953606, -35.65081837, -11.33399093, -12.45891245,
       -16.8542658 , -13.0695248 ,  -0.24295802,   8.74326716,
         4.97895475,  -5.51924792,  14.26608147,  23.94876107,
        15.59684682,   3.74189235,  10.75525122,   8.99057445,
        -1.86746398,  -3.99292506, -24.94530945, -21.8877767 ,
       -21.33791442, -17.79524782, -12.32917906,  19.16188799,
        15.4595896 ,  -2.35740787, -13.92482009, -10.90447392]
assert 4, eqObj(tick4.subarray(10:), validate4.subarray(10:), precision)

tick5 = exec result from res where sym = `tick5
validate5=[         nan,          nan,          nan,          nan,
                nan,          nan,          nan,          nan,
                nan,          nan, -21.77777778, -20.58679707,
        -2.25293711, -26.93795558, -47.79947784, -30.99852837,
       -31.22711565, -27.47340519, -46.41891194, -39.15778685,
       -36.3405679 , -39.51520145, -49.50734199, -17.22988076,
       -14.66271833, -13.09032955,  -7.36468114, -12.29829046,
        -1.17890159,   2.92864963,  -5.97771767,   7.93219077,
        12.20033235, -13.04504369, -11.69389177,  -3.0282853 ,
        -0.2979454 ,   3.03315549,  17.02989332,  18.66058595,
        20.39889521,  24.43609647,  15.06953883,   4.94233073,
        26.13125808,   4.87848805, -12.42759152, -17.22040695,
       -41.93659305, -54.2289723 , -37.14934981, -21.75202694,
       -19.73369031, -26.25381207, -14.61584599, -17.13068422,
       -30.96786627, -21.32132242, -30.04525575, -37.71838702,
       -38.6529671 , -29.47810738, -10.79078489,  -4.3543492 ,
       -25.26040569, -17.77924936,  -8.46444841, -24.95154093,
       -18.48455277, -25.0898894 , -39.33787757, -47.95387577,
       -45.99304645, -51.03980067, -40.12777323, -15.42057488,
       -16.58780977, -19.66733117, -14.95183809,  -6.55429103,
         1.85471302,   8.20902796,  -5.4013918 ,  -0.70984362,
        -8.41040498,  -5.73064651,  21.45181938,  40.17030744,
        28.80205606,  15.25490514,  33.61549003,  40.4772141 ,
        35.44453498,  10.95248995,  10.58823945,   1.00853682,
         3.50895291,   5.03199291,  -4.58956706,   0.26546169]
assert 5, eqObj(tick5, validate5, 3)
