#include "setup/settings.txt"
use ta

@testing:case="test_ta_function_stochf_different_length", exception=1
close = [0,100.243874,99.677051,100.676061,98.729214,99.811684,101.812203,99.706868,98.214068,99.034305,101.39895,99.739858,98.857177,100.976889,98.488709,99.175023,99.511593,99.997514,99.617737,100.372465,100.106315,100.600162,100.382803,100.136037,100.630854,99.995787,99.57589,102.56802,100.004189,99.821923,102.296099,100.156529,100.320803,101.438503,100.210978,98.201,99.909849,99.709805,100.728769,100.236768,99.456067]
low = [95.401008,94.447881,95.326995,95.746915,95.198542,92.241103,95.51542,96.047782,95.731797,95.768023,94.752951,94.835143,94.889078,96.764887,94.090907,96.445943,96.004783,95.375574,94.133554,94.610997,95.402233,96.695455,95.453434,93.24295,95.410741,95.962799,93.871181,94.916658,93.363155,95.244303,92.966322,95.014757,95.382246,95.910769,96.063154,94.119766,95.249352,93.487744,95.117606,94.431727]
high = [103.810071,103.376478,106.505625,104.882828,106.650134,104.851509,104.997041,102.39901,106.016652,106.119703,105.923447,105.016197,105.475379,105.680278,105.221281,104.706711,105.562832,103.630945,104.348365,101.928638,103.427024,103.717182,102.235982,105.059598,104.616881,104.771264,105.196628,104.601302,105.333064,105.143304,104.937159,106.393391,104.396807,105.240313,105.226435,102.110833,105.446478,103.893739,103.609393,103.860969]
fastk, fastd = stochf(high, low, close, 5, 3, 0)

@testing:case="test_ta_function_stochf_args_5_3_0"
close = [100.243874,99.677051,100.676061,98.729214,99.811684,101.812203,99.706868,98.214068,99.034305,101.39895,99.739858,98.857177,100.976889,98.488709,99.175023,99.511593,99.997514,99.617737,100.372465,100.106315,100.600162,100.382803,100.136037,100.630854,99.995787,99.57589,102.56802,100.004189,99.821923,102.296099,100.156529,100.320803,101.438503,100.210978,98.201,99.909849,99.709805,100.728769,100.236768,99.456067]
low = [95.401008,94.447881,95.326995,95.746915,95.198542,92.241103,95.51542,96.047782,95.731797,95.768023,94.752951,94.835143,94.889078,96.764887,94.090907,96.445943,96.004783,95.375574,94.133554,94.610997,95.402233,96.695455,95.453434,93.24295,95.410741,95.962799,93.871181,94.916658,93.363155,95.244303,92.966322,95.014757,95.382246,95.910769,96.063154,94.119766,95.249352,93.487744,95.117606,94.431727]
high = [103.810071,103.376478,106.505625,104.882828,106.650134,104.851509,104.997041,102.39901,106.016652,106.119703,105.923447,105.016197,105.475379,105.680278,105.221281,104.706711,105.562832,103.630945,104.348365,101.928638,103.427024,103.717182,102.235982,105.059598,104.616881,104.771264,105.196628,104.601302,105.333064,105.143304,104.937159,106.393391,104.396807,105.240313,105.226435,102.110833,105.446478,103.893739,103.609393,103.860969]
fastk, fastd = stochf(high, low, close, 5, 3, 0)
outk = [51.81309555, 41.45292629, 47.14544649, 65.98538037, 43.87275274, 36.10728905, 54.75564172, 32.86565942, 42.96724118, 46.77290942, 50.9657254 , 47.68878311, 54.75591934, 52.25842787, 56.57932198, 61.17831255, 58.76254588, 62.52114813, 57.14680678, 53.59337098, 78.01004846, 56.56199707, 53.95837178, 74.62833677, 58.1414814 , 54.77353993, 63.09776914, 53.95560267, 38.98600655, 47.17500331, 49.35270712, 60.55009669, 56.43594046, 49.90764909]
outd = [54.06496341, 53.23011196, 46.80382278, 51.52791772, 52.33452654, 48.65514072, 44.9118945 , 41.2428634 , 43.52951411, 40.86860334, 46.90195867, 48.47580598, 51.13680929, 51.56771011, 54.53122307, 56.6720208 , 58.84006014, 60.82066885, 59.47683359, 57.7537753 , 62.91674207, 62.7218055 , 62.84347243, 61.71623521, 62.24272999, 62.5144527 , 58.67093016, 57.27563725, 52.01312612, 46.70553751, 45.17123899, 52.35926904, 55.44624809, 55.63122875]
assert 1, eqObj(fastk[6:], outk, 6)
assert 2, eqObj(fastd[6:], outd, 6)

@testing:case="test_ta_function_stochf_args_5_3_0_starting_NULL"
close = [NULL,NULL,NULL,100.243874,99.677051,100.676061,98.729214,99.811684,101.812203,99.706868,98.214068,99.034305,101.39895,99.739858,98.857177,100.976889,98.488709,99.175023,99.511593,99.997514,99.617737,100.372465,100.106315,100.600162,100.382803,100.136037,100.630854,99.995787,99.57589,102.56802,100.004189,99.821923,102.296099,100.156529,100.320803,101.438503,100.210978,98.201,99.909849,99.709805,100.728769,100.236768,99.456067]
low = [NULL,NULL,NULL,95.401008,94.447881,95.326995,95.746915,95.198542,92.241103,95.51542,96.047782,95.731797,95.768023,94.752951,94.835143,94.889078,96.764887,94.090907,96.445943,96.004783,95.375574,94.133554,94.610997,95.402233,96.695455,95.453434,93.24295,95.410741,95.962799,93.871181,94.916658,93.363155,95.244303,92.966322,95.014757,95.382246,95.910769,96.063154,94.119766,95.249352,93.487744,95.117606,94.431727]
high = [NULL,NULL,NULL,103.810071,103.376478,106.505625,104.882828,106.650134,104.851509,104.997041,102.39901,106.016652,106.119703,105.923447,105.016197,105.475379,105.680278,105.221281,104.706711,105.562832,103.630945,104.348365,101.928638,103.427024,103.717182,102.235982,105.059598,104.616881,104.771264,105.196628,104.601302,105.333064,105.143304,104.937159,106.393391,104.396807,105.240313,105.226435,102.110833,105.446478,103.893739,103.609393,103.860969]
fastk, fastd = stochf(high, low, close, 5, 3, 0)
outk = [51.81309555, 41.45292629, 47.14544649, 65.98538037, 43.87275274, 36.10728905, 54.75564172, 32.86565942, 42.96724118, 46.77290942, 50.9657254 , 47.68878311, 54.75591934, 52.25842787, 56.57932198, 61.17831255, 58.76254588, 62.52114813, 57.14680678, 53.59337098, 78.01004846, 56.56199707, 53.95837178, 74.62833677, 58.1414814 , 54.77353993, 63.09776914, 53.95560267, 38.98600655, 47.17500331, 49.35270712, 60.55009669, 56.43594046, 49.90764909]
outd = [54.06496341, 53.23011196, 46.80382278, 51.52791772, 52.33452654, 48.65514072, 44.9118945 , 41.2428634 , 43.52951411, 40.86860334, 46.90195867, 48.47580598, 51.13680929, 51.56771011, 54.53122307, 56.6720208 , 58.84006014, 60.82066885, 59.47683359, 57.7537753 , 62.91674207, 62.7218055 , 62.84347243, 61.71623521, 62.24272999, 62.5144527 , 58.67093016, 57.27563725, 52.01312612, 46.70553751, 45.17123899, 52.35926904, 55.44624809, 55.63122875]
assert 1, eqObj(fastk[9:], outk, 6)
assert 2, eqObj(fastd[9:], outd, 6)

@testing:case="test_ta_function_stochf_args_3_5_1"
close = [100.243874,99.677051,100.676061,98.729214,99.811684,101.812203,99.706868,98.214068,99.034305,101.39895,99.739858,98.857177,100.976889,98.488709,99.175023,99.511593,99.997514,99.617737,100.372465,100.106315,100.600162,100.382803,100.136037,100.630854,99.995787,99.57589,102.56802,100.004189,99.821923,102.296099,100.156529,100.320803,101.438503,100.210978,98.201,99.909849,99.709805,100.728769,100.236768,99.456067]
low = [95.401008,94.447881,95.326995,95.746915,95.198542,92.241103,95.51542,96.047782,95.731797,95.768023,94.752951,94.835143,94.889078,96.764887,94.090907,96.445943,96.004783,95.375574,94.133554,94.610997,95.402233,96.695455,95.453434,93.24295,95.410741,95.962799,93.871181,94.916658,93.363155,95.244303,92.966322,95.014757,95.382246,95.910769,96.063154,94.119766,95.249352,93.487744,95.117606,94.431727]
high = [103.810071,103.376478,106.505625,104.882828,106.650134,104.851509,104.997041,102.39901,106.016652,106.119703,105.923447,105.016197,105.475379,105.680278,105.221281,104.706711,105.562832,103.630945,104.348365,101.928638,103.427024,103.717182,102.235982,105.059598,104.616881,104.771264,105.196628,104.601302,105.333064,105.143304,104.937159,106.393391,104.396807,105.240313,105.226435,102.110833,105.446478,103.893739,103.609393,103.860969]
fastk, fastd = stochf(high, low, close, 3, 5, 1)
outk = [51.81309555, 46.82497673, 33.50925872, 54.55529729, 43.87275274, 36.10728905, 55.71765121, 33.68852485, 43.86878287, 46.77290942, 51.48749665, 41.64185299, 54.5870964 , 58.47157622, 63.30619333, 63.38335977, 56.93124516, 62.52114813, 57.14680678, 53.59337098, 76.79024943, 54.15245862, 53.95837178, 74.62833677, 58.1414814 , 54.77353993, 63.09776914, 45.66647455, 28.59337434, 52.06653054, 49.35270712, 60.55009669, 56.43594046, 57.3546595]
outd = [49.13622401, 48.36580825, 43.41362508, 47.12751581, 46.04259479, 42.73082621, 47.05976788, 42.60268687, 43.02471887, 44.27411572, 46.67857603, 44.99966835, 48.1954777 , 51.62084387, 55.51596036, 58.13842683, 57.73603294, 59.33107134, 58.60298315, 56.93311243, 63.55215809, 60.41892493, 58.26540722, 63.71971707, 61.86030518, 59.4980501 , 60.69795644, 55.68746248, 46.65609977, 48.45957669, 48.75728684, 52.68822345, 53.93746246, 55.07652814]
assert 1, eqObj(fastk[6:], outk, 6)
assert 2, eqObj(fastd[6:], outd, 6)

@testing:case="test_ta_function_stochf_context_by"
precision = 6
tickTB = loadText(DATA_DIR+"/ticks1.csv")

fastk = (exec stochf(high, low, close, 5, 3, 0)[0] as slowk from tickTB context by sym).slowk
fastd = (exec stochf(high, low, close, 5, 3, 0)[1] as slowd from tickTB context by sym).slowd

outk = [00F,00F,00F,00F,00F,00F,85.815603,96.515679,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,0,3.806735,93.823038,100,90.09434,82.900943,70.676692,35.964912,9.236948,56.934307,20.80292,5,33.211679,86.49635,78.472222,73.263889,83.680556,76.549865,53.416149,3.10559,19.537275,0,2.023121,0,24.390244,24.642857,52.697095,74.885845,68.871595,44.978166,0,0.867052,21.038251,23.890785,17.808219,40.106952,42.245989,67.914439,50,88,73.758865,74.468085,65.19337,86.187845,72.670807,70.807453,89.440994,78.571429,100,90.625,74.107143,76.960784,83.027523,83.333333,56.140351,54.62963,50,69.411765,22.807018,24.087591,61.313869,77.372263,56.934307,82.5,79.699248,71.794872,63.247863,0.515464,2.836879,22.419929,22.857143,3.846154,32.692308,21.052632,24.657534,15.044248,7.33945,5.681818,13.402062,18.064516,55.862069,91.851852,63.703704,82.962963,59.813084,64.615385,71.641791,46.268657,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,17.5,15.384615,72.580645,80.487805,82.926829,40.425532,43.262411,1.129944,0,34.057971,34.562212,0,30.412371,78.350515,32.474227,22.651934,71.270718,89.502762,80.620155,81.395349,63.101604,74.342105,65.882353,60,64.166667,20.792079,4,27.45098,41.780822,33.561644,50.892857,91.818182,89.534884,98.290598,98.319328,54.807692,15.789474,36.440678,25.423729,14.792899,19.69697,0,2.739726,27.346939,67.156863,68.393782,64.130435,56,100,18.897638,50.60241,41.566265,9.189189,1.593625,13.157895,32.227488,38.755981,14.09396,37.362637,53.571429,0,34.306569,20,5.555556,1.948052,9.375,25.625,50.35461,100,77.245509,68.263473,68.571429,80.952381,88.372093,77.906977,47.674419,98.837209,86.440678,70.338983,45.762712,62.711864,36.842105,12.5,14.285714,6.666667,37.278107,41.025641,53.846154,61.71875,100,93.518519,57.281553,29.126214,31.632653,00F,00F,00F,00F,00F,00F,34.065934,23,21.212121,72.857143,32.857143,54.022989,91.954023,13.084112,0,36.051502,35.622318,39.055794,1.724138,22.834646,27.559055,17.647059,19.254658,90.598291,88.28125,81.25,90.972222,71.578947,91.428571,89.189189,45.205479,89.189189,67.058824,3.225806,23.684211,40.350877,45.614035,60.204082,94.791667,85.393258,87.323944,62.765957,47.826087,28.409091,78.409091,33.333333,22.962963,14.074074,0.990099,3.249097,20.547945,43.850267,58,53.389831,75.862069,68.965517,2.298851,47.663551,18.269231,19.310345,27.5,48.543689,90.816327,85.950413,32.231405,35.643564,57.425743,7.54717,28.571429,6.329114,4.964539,2.484472,15.131579,15.384615,29.166667,100,79.527559,71.653543,76.363636,84.615385,90.625,96.052632,44.94382,50,28.205128,37.037037,100,100,64.953271,50.934579,74.43609,74.556213,59.278351,27.835052,19.428571,10.695187,14.438503,32.631579,20,39.56044]
outk.nullFill!(fastk)
outd = [00F,00F,00F,00F,00F,00F,64.008928,91.211877,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,4.741171,2.865428,32.543258,65.876591,94.639126,90.998428,81.223992,63.180849,38.626184,34.045389,28.991391,27.579075,19.671533,41.569343,66.060084,79.41082,78.472222,77.831437,71.215523,44.357201,25.353005,7.547622,7.186799,0.674374,8.804455,16.344367,33.910065,50.741932,65.484845,62.911869,37.94992,15.281739,7.301768,15.265363,20.912419,27.268652,33.387053,50.089127,53.386809,68.638146,70.586288,78.742317,71.140107,75.2831,74.684008,76.555369,77.639752,79.606625,89.337474,89.732143,88.244048,80.564309,78.031817,81.107214,74.167069,64.701105,53.589994,58.013798,47.406261,38.768791,36.069492,54.257908,65.206813,72.268856,73.044518,77.99804,71.580661,45.186066,22.200069,8.590757,16.037984,16.374409,19.798535,19.197031,26.134158,20.251471,15.680411,9.355172,8.807777,12.382799,29.109549,55.259479,70.472542,79.506173,68.826584,69.130477,65.356753,60.841944,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,29.16267,23.739316,35.155087,56.151022,78.665093,67.946722,55.538258,28.272629,14.797452,11.729305,22.873394,22.873394,21.658194,36.254296,47.079038,44.492225,42.132293,61.141805,80.464545,83.839422,75.039036,72.946353,67.775354,66.741486,63.349673,48.319582,29.652915,17.414353,24.410601,34.264482,42.078441,58.757561,77.415308,93.214555,95.381603,83.805873,56.305498,35.679281,25.884627,25.552435,19.971199,11.496623,7.478899,10.028888,32.414509,54.299195,66.56036,62.841406,73.376812,58.299213,56.500016,37.022104,33.785955,17.449693,7.980236,15.659669,28.047121,28.359143,30.070859,35.009342,30.311355,29.292666,18.10219,19.954042,9.167869,5.626203,12.316017,28.451537,58.65987,75.866706,81.836327,71.360137,72.595761,79.298634,82.410484,71.317829,74.806202,77.650769,85.205623,67.514124,59.60452,48.438894,37.351323,21.209273,11.150794,19.410162,28.323471,44.049967,52.196848,71.854968,85.07909,83.600024,59.975429,39.346807,00F,00F,00F,00F,00F,00F,35.024562,32.355311,26.092685,39.023088,42.308802,53.245758,59.611385,53.020375,35.012712,16.378538,23.891273,36.909871,25.467417,21.204859,17.372613,22.680253,21.486924,42.500003,66.044733,86.709847,86.834491,81.267057,84.659914,84.065569,75.274413,74.527953,67.151164,53.15794,31.322947,22.420298,36.549708,48.722998,66.869928,80.129669,89.169623,78.494387,65.971996,46.333712,51.54809,46.717172,44.901796,23.45679,12.675712,6.104424,8.262381,22.549103,40.799404,51.746699,62.4173,66.072472,49.042146,39.64264,22.743878,28.414376,21.693192,31.784678,55.620005,75.103476,69.666048,51.275128,41.766904,33.538826,31.181447,14.149237,13.288361,4.592708,7.526863,11.000222,19.894287,48.183761,69.564742,83.727034,75.848246,77.544188,83.868007,90.431005,77.207151,63.665484,41.049649,38.414055,55.080722,79.012346,88.317757,71.962617,63.441314,66.642294,69.423551,53.889872,35.513991,19.319603,14.854087,19.25509,22.356694,30.730673]
outd.nullFill!(fastd)
assert 1, eqObj(fastk, outk, precision)
assert 2, eqObj(fastd, outd, precision)
