use ta;

#include "setup/settings.txt"
timePeriod=10
tickTB=loadText(DATA_DIR+"/ticks1.csv")
nan=double()
@testing:case="test_ta_function_ta::trange_use_tick1"
a1 = exec ta::trange(high, low, close) from tickTB where sym=`tick1
b1 = NULL 0.86 0.73 0.62 1.21 1.27 1.35 0.7
assert 1, eqObj(a1,b1,5)

a2 = exec ta::trange(high, low, close) from tickTB where sym=`tick2
b2 = [ nan,  nan,  nan,  nan,  nan,  nan,  nan, 1.01, 1.22, 1.3 , 5.99,
       0.9 , 0.77, 0.92, 5.73, 2.02, 2.19, 0.77, 1.42, 1.32, 0.5 , 1.9 ,
       1.23, 1.27, 0.95, 2.06, 0.95, 0.7 , 1.97, 1.99, 0.67, 1.62, 0.86,
       1.2 , 0.81, 1.09, 1.5 , 0.61, 0.91, 0.78, 1.17, 0.58, 1.41, 0.93,
       0.91, 0.9 , 1.08, 0.61, 0.34, 1.18, 0.58, 0.84, 0.52, 0.31, 1.39,
       0.69, 0.63, 0.46, 0.69, 0.47, 1.31, 0.61, 0.52, 0.53, 1.06, 0.52,
       0.64, 0.7 , 0.44, 0.64, 1.  , 0.49, 0.74, 0.34, 0.43, 0.59, 0.77,
       0.39, 0.5 , 1.6 , 0.89, 0.73, 0.33, 0.58, 0.43, 0.25, 0.52, 0.65,
       0.22, 0.77, 0.55, 0.7 , 0.64, 0.63, 0.43, 0.5 , 0.3 , 0.5 , 0.35,
       0.3 ]
assert 2, eqObj(a2,b2,2)

a3 = exec ta::trange(high, low, close) from tickTB where sym=`tick3
b3 = [NULL,0.91,1.09,1.37,2.5]
assert 3, eqObj(a3,b3,5)

a4 = exec ta::trange(high, low, close) from tickTB where sym=`tick4
b4 = [NULL,1.08,0.53,0.68,1.14,0.54,0.28,0.52,0.91,0.53,0.41,1.37,0.45,1.14,1.05,0.94,0.52,1.02,0.81,0.93,0.95,0.92,0.88,0.73,0.96,0.4,0.34,0.42,0.31,0.67,0.73,0.88,0.84,0.8,0.21,0.37,0.31,0.62,0.34,0.52,0.83,0.51,0.67,0.45,0.47,0.9,0.4,1.05,1.16,0.65,1.43,0.34,0.85,0.98,0.9,1.03,0.96,0.62,0.96,1.02,0.64,0.67,0.35,0.67,0.29,0.32,0.75,0.48,0.39,0.48,0.55,0.72,0.5,0.47,0.62,0.61,0.26,0.32,0.47,0.44,0.25,0.38,0.7,0.49,0.48,0.41,0.31,0.3,0.44,0.24,0.79,0.75,0.41,0.49,0.58,0.78,0.31,0.42,0.63,0.34]
assert 4, eqObj(a4,b4,5)

a5 = exec ta::trange(high, low, close) from tickTB where sym=`tick5
b5 = [NULL,0.7,0.62,0.6,0.89,0.58,0.35,0.49,0.45,0.44,0.3,0.74,0.46,0.95,0.94,0.88,0.63,0.32,0.89,0.38,0.48,0.34,0.92,0.76,0.49,0.57,0.25,0.32,0.32,0.23,0.43,0.51,0.5,0.77,0.54,0.29,0.29,0.22,0.45,0.27,0.33,0.44,0.43,0.43,0.45,0.67,0.77,0.37,0.86,0.93,0.52,0.9,0.51,0.53,0.6,0.35,0.51,0.53,0.35,0.74,0.59,0.27,0.67,0.37,0.7,0.42,0.4,0.63,0.31,0.23,0.76,0.51,0.6,0.56,0.35,0.56,0.35,0.26,0.19,0.2,0.33,0.33,0.49,0.41,0.34,0.34,0.63,0.69,0.83,0.51,0.73,0.77,0.8,0.7,0.8,0.62,0.29,0.59,0.45,0.47]
assert 1, eqObj(a5,b5,5)


a6 = (exec ta::trange(high, low, close) from tickTB context by sym).values()[0]
b6 = b1.join(b2).join(b3).join(b4).join(b5)
assert 6, eqObj(a6,b6,5)
