#include "setup/settings.txt"
use ta

//mom(close, timePeriod)
@testing:case="test_ta_function_mom_take40"
close=double(1..40)
talib=take(double(),10).append!([ 10., 10., 10.,
       10., 10., 10., 10., 10., 10., 10., 10., 10., 10., 10., 10., 10.,
       10., 10., 10., 10., 10., 10., 10., 10., 10., 10., 10., 10., 10.,
       10.])
assert 1, eqObj(mom(close,10),talib)
talib=take(double(),5).append!([ 5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,
        5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,
        5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,  5.,
        5.])
assert 2, eqObj(mom(close,5),talib)
talib=take(double(),40)
assert 3, eqObj(mom(close,40),talib)

@testing:case="test_ta_function_mom_rand40"
close =[56.84486603, 63.63574239, 17.24385137, 14.96223024, 79.31584397,
       55.19487319, 76.11299983,  8.6658699 , 23.08781124, 35.93374603,
       76.92630291, 32.72657806, 42.13828084, 55.27681132, 95.80582219,
       58.47228524, 13.48667322, 85.25350829, 11.76174822, 27.89005755,
        7.8807707 , 14.4892506 , 54.22748916, 21.95583062, 67.02994747,
        9.96686312, 55.93319639, 71.14257436,  5.82524944, 71.46937892,
       56.47772433, 95.07794425, 79.77511056, 94.64802509, 68.46983317,
        5.71675094, 11.19925125, 97.10198567, 73.83804116,  4.85530577]
talib=take(double(),10).append!([ 20.08143688, -30.90916432,
        24.89442947,  40.31458109,  16.48997821,   3.27741205,
       -62.62632661,  76.58763839, -11.32606302,  -8.04368847,
       -69.04553221, -18.23732746,  12.08920832, -33.3209807 ,
       -28.77587472, -48.50542212,  42.44652317, -14.11093394,
        -5.93649878,  43.57932137,  48.59695364,  80.58869365,
        25.5476214 ,  72.69219447,   1.4398857 ,  -4.25011218,
       -44.73394514,  25.95941132,  68.01279171, -66.61407316])
assert 1, eqObj(mom(close,10),talib,5)
talib=take(double(),20).append!([ -48.96409533, -49.14649178,  36.98363779,   6.99360038,
       -12.28589651, -45.22801007, -20.17980344,  62.47670445,
       -17.26256179,  35.5356329 , -20.44857858,  62.35136618,
        37.63682972,  39.37121376, -27.33598902, -52.7555343 ,
        -2.28742197,  11.84847738,  62.07629294, -23.03475179])
assert 2, eqObj(mom(close,20),talib,5)

@testing:case="test_ta_function_mom_bigarray"
close=bigarray(DOUBLE,0,2000000).append!(1..2000000)
talib=bigarray(DOUBLE,2000000,2000000,10)
talib[0:10]=NULL
assert 1, eqObj(mom(close,10),talib)
talib=bigarray(DOUBLE,2000000,2000000,20)
talib[0:20]=NULL
assert 2, eqObj(mom(close,20),talib)
talib=bigarray(DOUBLE,2000000,2000000,NULL)
assert 3, eqObj(mom(close,2000001),talib)


@testing:case="test_ta_function_mom_null"
close =[56.84486603, 63.63574239, 17.24385137, 14.96223024, 79.31584397,
       55.19487319, 76.11299983,  8.6658699 , 23.08781124, 35.93374603,
       76.92630291, 32.72657806, , 55.27681132, 95.80582219,, 
       13.48667322, 85.25350829, 11.76174822, 27.89005755,
        7.8807707 , 14.4892506 , , 21.95583062, 67.02994747,
        9.96686312, 55.93319639, 71.14257436,  5.82524944, 71.46937892,
       56.47772433, 95.07794425,, 94.64802509, 68.46983317,
        5.71675094, 11.19925125, 97.10198567, 73.83804116,  4.85530577]
talib=take(double(),10).append!([20.08143688,-30.90916433,,40.31458108 ,16.48997822,,-62.62632661,
	76.58763839,-11.32606302 ,-8.04368848,-69.04553221,-18.23732746 ,, -33.3209807  ,
	-28.77587472,, 42.44652317,-14.11093393,-5.93649878 ,43.57932137,48.59695363 ,
	80.58869365 ,, 72.69219447 ,1.4398857,-4.25011218,-44.73394514 ,25.95941131,
	68.01279172,-66.61407315])
assert 1, eqObj(mom(close,10),talib)
talib=take(double(),20).append!([ -48.96409533,-49.14649179, ,6.99360038, -12.2858965,
 	-45.22801007 ,-20.17980344 ,62.47670446, -17.2625618 , 35.53563289,
 	-20.44857858,  62.35136619,,39.37121377, -27.33598902,,-2.28742197 ,
 	11.84847738 ,62.07629294,-23.03475178])
assert 2, eqObj(mom(close,20),talib)

@testing:case="test_ta_function_mom_csv"
timePeriod=10
tickTB=loadText(DATA_DIR+"/ticks1.csv")
tick1=exec mom(close, timePeriod) from tickTB where sym=`tick1
rs1=take(double(), 8)
assert 1, eqObj(tick1, rs1, 5)

tick2=exec mom(close, timePeriod) from tickTB where sym=`tick2
rs2=[, , , , , , , , , , , , , , , ,  2.24,  0.72, -0.02, -0.34,  4.93,  6.1 ,  5.61,  4.87, -0.04, -0.04, -0.71,
       -0.25, -0.23,  1.53,  0.97, -1.5 , -0.52, -0.74, -1.12, -3.15,
       -3.44, -3.3 , -3.02, -3.39, -2.63, -1.47, -2.73, -2.46, -1.99,
       -1.49, -1.65, -1.41, -1.95, -1.84, -2.51, -1.4 , -0.19,  0.72,
        0.72,  1.17,  1.76,  1.5 ,  1.76,  1.21,  3.03,  2.63,  2.32,
        2.42,  2.39,  2.19,  1.85,  1.91,  1.56,  1.91,  0.3 , -0.11,
        0.77,  0.88,  0.09,  0.12,  0.76,  0.67,  0.62, -1.16, -1.64,
       -1.05, -1.55, -2.31, -1.82, -2.21, -2.52, -2.94, -2.93, -2.08,
       -1.29, -2.  , -1.48, -0.51, -1.1 , -0.66, -0.88, -0.2 , -0.05,
        0.43]
assert 2, eqObj(tick2, rs2, 5)

tick3=exec mom(close, timePeriod) from tickTB where sym=`tick3
rs3=take(double(), 5)
assert 3, eqObj(tick3, rs3,5)

tick4=exec mom(close, timePeriod) from tickTB where sym=`tick4
rs4=[  , , , , , , , , , ,  0.64, -0.71, -0.46, -1.65, -1.92, -1.19, -1.13, -2.04,
       -2.63, -1.79, -2.71, -2.59, -1.75, -0.47,  1.04,  0.12,  0.1 ,
        1.42,  1.41,  0.67,  1.61,  1.75,  0.47,  0.23, -0.04, -0.18,
        0.11,  0.25,  0.2 ,  0.39,  0.4 ,  0.32,  0.23,  0.35,  0.03,
       -0.5 , -0.57, -1.99, -2.84, -2.63, -1.99, -1.59, -1.24, -1.56,
       -0.53, -0.87, -0.67,  0.16,  0.25, -1.13, -2.04, -1.61, -1.34,
       -1.83, -2.6 , -1.43, -2.39, -2.03, -1.56, -1.04, -1.35, -1.77,
       -1.93, -1.03, -0.54, -0.76, -0.16, -0.28,  0.28,  0.8 ,  1.23,
        1.01,  1.58,  1.61,  0.8 ,  0.55,  0.9 ,  0.77,  0.2 , -0.1 ,
       -0.59, -0.27, -0.8 , -1.07, -0.79,  0.18, -0.09, -0.42, -0.46,
       -0.35]
assert 4, eqObj(tick4, rs4, 5)

tick5=exec mom(close, timePeriod) from tickTB where sym=`tick5
rs5=[ , , , , , , , , , , -0.49, -0.56, -0.13, -1.05, -1.33, -1.18, -1.06, -0.81,
       -1.67, -1.81, -1.47, -1.63, -2.46, -1.05, -0.04, -0.38, -0.23,
       -0.45,  0.7 ,  0.64,  0.37,  0.84,  1.45,  0.08,  0.04,  0.19,
        0.11,  0.32,  0.38,  0.32,  0.57,  0.33,  0.09,  0.56,  0.97,
        0.42, -0.02, -0.21, -1.37, -2.09, -1.77, -1.49, -1.31, -1.4 ,
       -1.57, -1.29, -1.4 , -1.07, -0.55, -0.19, -0.59, -0.79, -0.45,
       -0.06, -0.98, -0.73, -0.02, -0.78, -0.31, -0.22, -0.78, -1.42,
       -1.77, -2.2 , -1.34, -0.95, -1.21, -0.76, -0.81, -0.4 ,  0.39,
        1.01,  0.67,  1.05,  0.67,  0.16,  0.83,  1.62,  1.29,  0.81,
        1.33,  1.52,  1.71,  1.  ,  1.16,  0.85,  0.29, -0.36, -0.36,
        0.05]
assert 5, eqObj(tick5, rs5, 5)

momBySym=(exec mom(close, timePeriod) from tickTB context by sym).values()[0]
rs=rs1.join(rs2).join(rs3).join(rs4).join(rs5)
assert 6, eqObj(momBySym, rs, 5)
