
#include "setup/settings.txt"

use ta

//linearreg_intercept(close, timeperiod=14)

@testing:case="test_ta_function_linearreg_intercept"
x=[89.79,11.58,99.9,81.11,84.69,31.38,60.9,83.3,97.26,98.67]

validate=[ , , , , 61.548, 56.854, 97.142, 72.158, 56.094, 40.114]
assert 1,eqObj(ta::linearreg_intercept(x,5),validate,6)

validate=[ , , , , , 72.9447619, 58.40619048, 87.61380952, 65.52809524, 55.32333333]
assert 2,eqObj(ta::linearreg_intercept(x,6),validate,6)

validate=[ , , , , , , 72.29428571, 55.32678571, 79.8625,     62.85785714]
assert 3,eqObj(ta::linearreg_intercept(x,7),validate,6)

close=[5.18,71.01,76.28,5.92,52.97,16.45,92.88,7.37,79.39,15.82]
t=table(take(`A`B,10) as sym,close)
re=exec ta::linearreg_intercept(close,5) from t
validate=[ , , , , 36.174, 71.012, 40.154, 26.556, 41.06,  45.332]
assert 4,eqObj(re,validate,6)

@testing:case="test_ta_function_linearreg_intercept_context_by"
tick = loadText(DATA_DIR + "/ticks1.csv")
res = select sym, ta::linearreg_intercept(close, 10) as linearreg_intercept from tick context by sym 
tick1 = exec linearreg_intercept from res where sym = `tick1
validate1 = take(double(), 8)
assert 1, eqObj(tick1, validate1, 6)
tick2 = exec linearreg_intercept from res where sym = `tick2
validate2 = [ , , , , , ,
  , , , , , ,
  , , , 14.34218182, 13.32690909, 12.15854545,
 10.58072727,  9.43018182, 10.40727273, 11.65763636, 13.58472727, 16.04,
 16.55145455, 16.26436364, 15.76709091, 15.49690909, 15.05745455, 14.90581818,
 14.95727273, 14.95727273, 15.27290909, 16.11036364, 16.71727273, 16.762,
 16.73709091, 16.586,      16.05054545, 15.00054545, 13.99872727, 13.56836364,
 13.24654545, 13.37472727, 13.26218182, 13.27927273, 13.45654545, 13.51436364,
 13.25745455, 12.67636364, 12.02145455, 11.31909091, 11.05709091, 11.14327273,
 10.97418182, 10.81709091, 10.94345455, 11.07818182, 11.23509091, 11.30618182,
 11.47309091, 11.50890909, 11.766,      12.12963636, 12.33509091, 12.49272727,
 12.80290909, 13.22163636, 13.63181818, 14.11436364, 14.23709091, 14.29945455,
 14.42963636, 14.52581818, 14.50672727, 14.39,       14.35581818, 14.35981818,
 14.43490909, 14.65,       15.05163636, 15.36527273, 15.41618182, 15.37309091,
 15.28545455, 15.04072727, 14.54054545, 13.99672727, 13.34563636, 13.22927273,
 13.32636364, 13.22181818, 12.92709091, 12.70509091, 12.42654545, 12.12218182,
 11.80290909, 11.59854545, 11.41054545, 11.50454545]
assert 2, eqObj(tick2, validate2, 6)
tick3 = exec linearreg_intercept from res where sym = `tick3
validate3 = take(double(), 5)
assert 3, eqObj(tick3, validate3, 6)
tick4 = exec linearreg_intercept from res where sym = `tick4
validate4 = [ , , , , , , , , , 11.72490909, 11.796,      11.70563636,
 11.65472727, 11.62090909, 11.96181818, 11.97727273, 12.05545455, 12.26436364,
 12.066,      11.55290909, 11.05963636, 10.74472727, 10.14454545,  9.78090909,
  9.74472727,  9.38636364,  9.14109091,  9.26563636,  9.40909091,  9.22981818,
  9.43581818,  9.98745455, 10.34072727, 10.57454545, 10.60927273, 10.65127273,
 10.75581818, 10.68236364, 10.57527273, 10.34781818, 10.11290909, 10.11327273,
 10.36236364, 10.55745455, 10.71454545, 11.01581818, 11.25636364, 11.43236364,
 11.59618182, 11.36727273, 10.86909091, 10.44963636, 10.15981818,  9.73436364,
  9.14490909,  8.93054545,  8.63418182,  8.71509091,  9.228,      9.63345455,
  9.72781818,  9.67563636,  9.57272727,  9.528,       9.00454545,  8.70909091,
  8.36072727,  7.91145455,  7.67036364,  7.69945455,  7.83145455,  7.74363636,
  7.51163636,  7.37072727,  7.03145455,  6.59654545,  6.442,       6.18163636,
  5.95545455,  5.81618182,  5.94163636,  6.188,       6.42290909,  6.576,
  6.59654545,  6.71890909,  6.90218182,  7.10436364,  7.25690909,  7.32763636,
  7.51327273,  7.762,       7.77854545,  7.61072727,  7.44745455,  7.25818182,
  7.00890909,  6.82454545,  6.75945455,  6.68054545]
assert 4, eqObj(tick4, validate4, 6)
tick5 = exec linearreg_intercept from res where sym = `tick5
validate5 = [ , , , , , , , , ,10.31272727, 10.28745455, 10.19654545,
 10.06709091,  9.92254545, 10.12145455, 10.10054545, 10.06872727, 10.03545455,
 10.09945455,  9.92909091,  9.76327273,  9.52963636,  9.14781818,  8.78672727,
  8.73418182,  8.52163636,  8.272,       7.99818182,  8.018,       7.99745455,
  8.01836364,  8.06745455,  8.34636364,  8.49454545,  8.61472727,  8.69345455,
  8.71781818,  8.794,       8.73709091,  8.65509091,  8.66872727,  8.56836364,
  8.46090909,  8.62818182,  8.75,        8.90109091,  9.10636364,  9.3,
  9.47636364,  9.66090909,  9.66309091,  9.47890909,  9.25818182,  9.06090909,
  8.572,       8.15309091,  7.88709091,  7.56218182,  7.56145455,  7.84927273,
  7.98854545,  7.92290909,  7.73745455,  7.60163636,  7.44909091,  7.25036364,
  7.17581818,  7.09618182,  7.08018182,  7.20872727,  7.42854545,  7.60618182,
  7.54454545,  7.36709091,  7.29909091,  7.00854545,  6.584,       6.328,
  5.956,       5.60563636,  5.44581818,  5.47345455,  5.58381818,  5.82818182,
  6.07054545,  6.11818182,  6.09890909,  6.06454545,  6.112,       6.20145455,
  6.15581818,  6.07327273,  6.20963636,  6.488,       6.89036364,  7.37381818,
  7.64145455,  7.64309091,  7.75054545,  7.94236364]
assert 5, eqObj(tick5, validate5, 6)
