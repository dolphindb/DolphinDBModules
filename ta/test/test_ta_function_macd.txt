#include "setup/settings.txt"
use ta
//macd(close, fastPeriod, slowPeriod, signalPeriod)

precision=5
@testing:case="test_ta_function_macd_40"
close=1..40
result = macd(close, 4, 6, 3)
assert 1, eqObj(result[0], take(double(),7).append!([1.,  1.,  1.,  1.,  1.,  1.,1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1., 1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,1.]),precision)
close[0]=NULL
result = macd(close, 4, 6, 3)
assert 2, eqObj(result[0], take(double(),8).append!([1.,  1.,  1.,  1.,  1.,1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1., 1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,  1.,1.]),precision)

@testing:case="test_ta_function_macd_5_withNULL"
high = [4.87661076, 5.09258627, NULL, 4.51989263, 0.85037274]

result = macd(high, 2, 2, 2)
assert 1, result[0] == [NULL, NULL, 0, 0, 0]

@testing:case="test_ta_function_macd_rand40"
close=[0.738943,54.656038,68.600639,48.727166,29.061742,80.547883,88.441286,53.563787,84.333949,86.184134,79.958874,80.857146,16.09588,70.020608,46.971058,5.667949,35.074464,50.96734,13.780723,12.020372,60.611425,17.038672,93.005266,21.724079,78.437219,17.679625,78.095357,68.494213,78.234003,24.844407,81.324836,89.290484,29.122386,47.330442,32.111762,59.484709,24.228521,55.667259,42.17003,42.415287]
result = macd(close,4, 6, 3)
assert 1, eqObj(result[0],take(double(),7).append!([5.71475288,  6.51146998,  6.32020189,4.80446277,  3.70843849, -4.58639528, -1.45433853, -2.58005266,  -7.48799372,
-5.37488175, -2.03866145, -4.62576196, -5.40704378,0.42933222, -2.09817353,  5.74029744,  0.29718678,  4.41196258,
       -1.2725114 ,  3.34137042,  3.83960384,  4.72743944, -1.5340065 ,
        2.41273787,  4.73881805, -1.68222371, -2.16092393, -3.85839614,
       -1.01658788, -3.7117672 , -0.84964346, -1.06845735, -1.01209595]),precision)


@testing:case="test_ta_function_macd_rand40_withNULL"
close=[0.738943,54.656038,68.600639,48.727166,29.061742,80.547883,88.441286,53.563787,84.333949,86.184134,79.958874,80.857146,16.09588,70.020608,46.971058,5.667949,35.074464,50.96734,13.780723,12.020372,60.611425,17.038672,93.005266,21.724079,78.437219,17.679625,78.095357,68.494213,78.234003,24.844407,81.324836,89.290484,29.122386,47.330442,32.111762,59.484709,24.228521,55.667259,42.17003,42.415287]
close[0]=NULL
result = macd(close,4, 6, 3)
assert 1, eqObj(result[0],take(double(),8).append!([2.306576  ,  3.63443641,
        3.076697  ,  2.58870296, -5.31757665, -1.93543309, -2.89898493,
       -7.70097847, -5.5181193 , -2.13563734, -4.69182846, -5.45231294,
        0.39814981, -2.11975504,  5.72529705,  0.2867212 ,  4.40463656,
       -1.27765464,  3.33775046,  3.83705043,  4.72563493, -1.53528381,
        2.41183247,  4.73817551, -1.68268016, -2.16124845, -3.85862704,
       -1.01675226, -3.7118843 , -0.84972691, -1.06851684, -1.01213837]),precision)

@testing:case="test_ta_function_macd_context_by_NULL"
nan=double()
tickTB = loadText(DATA_DIR + "/ticks1.csv")

tick1=exec ta::macd(close,10,6,3) from tickTB where sym=`tick1
rs1=([nan, nan, nan, nan, nan, nan, nan, nan],
       [nan, nan, nan, nan, nan, nan, nan, nan],
       [nan, nan, nan, nan, nan, nan, nan, nan])
assert 1, eqObj(tick1, rs1, precision)

tick2=exec ta::macd(close,10,6,3) from tickTB where sym=`tick2
rs2=([            nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan, -2.81499241e-01,
         1.98706183e-02,  8.89895949e-02,  1.17488239e-01,
         2.16351693e-01,  1.60032845e-01,  2.01045393e-02,
        -1.59628882e-02,  1.15476298e-01,  1.74864066e-01,
         1.84902940e-01,  2.12333299e-01,  2.94216843e-01,
         2.61332325e-01,  6.02267071e-02, -6.14701715e-02,
        -2.50956910e-01, -3.41386463e-01, -4.35721320e-01,
        -5.09775649e-01, -5.27611262e-01, -4.50366555e-01,
        -3.43386320e-01, -2.49520660e-01, -2.29494201e-01,
        -3.37816702e-01, -4.77079633e-01, -4.77579807e-01,
        -4.60335503e-01, -4.84525948e-01, -4.49596939e-01,
        -4.01672352e-01, -3.02928250e-01, -2.85588022e-01,
        -1.93085914e-01, -1.35229569e-01, -9.33535458e-02,
        -7.92711428e-03,  8.18897412e-02,  1.33242982e-01,
         1.53216020e-01,  1.88098132e-01,  1.91439723e-01,
         3.16434693e-01,  3.99019562e-01,  3.88113598e-01,
         3.73006810e-01,  3.97788203e-01,  4.10307812e-01,
         3.64101982e-01,  3.21301070e-01,  2.74401780e-01,
         2.61829375e-01,  2.06594626e-01,  1.46959012e-01,
         1.57459809e-01,  1.78274051e-01,  1.52086319e-01,
         1.50699395e-01,  1.76346029e-01,  1.75939722e-01,
         1.56172934e-01, -1.93361201e-02, -2.05057717e-01,
        -2.58268639e-01, -2.74910418e-01, -3.26458968e-01,
        -3.17807654e-01, -3.14943502e-01, -2.94831024e-01,
        -3.17631210e-01, -3.23806321e-01, -3.78126513e-01,
        -3.92307065e-01, -4.09305722e-01, -3.42912433e-01,
        -2.41622202e-01, -2.09355329e-01, -1.52609477e-01,
        -1.32297773e-01, -9.27754640e-02, -5.86247399e-02,
        -5.32834211e-02],
       [            nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan, -8.41625288e-01,
        -4.10877335e-01, -1.60943870e-01, -2.17278157e-02,
         9.73119388e-02,  1.28672392e-01,  7.43884657e-02,
         2.92127887e-02,  7.23445432e-02,  1.23604305e-01,
         1.54253623e-01,  1.83293461e-01,  2.38755152e-01,
         2.50043739e-01,  1.55135223e-01,  4.68325257e-02,
        -1.02062192e-01, -2.21724327e-01, -3.28722824e-01,
        -4.19249237e-01, -4.73430249e-01, -4.61898402e-01,
        -4.02642361e-01, -3.26081511e-01, -2.77787856e-01,
        -3.07802279e-01, -3.92440956e-01, -4.35010381e-01,
        -4.47672942e-01, -4.66099445e-01, -4.57848192e-01,
        -4.29760272e-01, -3.66344261e-01, -3.25966142e-01,
        -2.59526028e-01, -1.97377798e-01, -1.45365672e-01,
        -7.66463932e-02,  2.62167404e-03,  6.79323280e-02,
         1.10574174e-01,  1.49336153e-01,  1.70387938e-01,
         2.43411315e-01,  3.21215438e-01,  3.54664518e-01,
         3.63835664e-01,  3.80811933e-01,  3.95559873e-01,
         3.79830927e-01,  3.50565999e-01,  3.12483889e-01,
         2.87156632e-01,  2.46875629e-01,  1.96917321e-01,
         1.77188565e-01,  1.77731308e-01,  1.64908814e-01,
         1.57804104e-01,  1.67075066e-01,  1.71507394e-01,
         1.63840164e-01,  7.22520221e-02, -6.64028475e-02,
        -1.62335743e-01, -2.18623080e-01, -2.72541024e-01,
        -2.95174339e-01, -3.05058921e-01, -2.99944972e-01,
        -3.08788091e-01, -3.16297206e-01, -3.47211859e-01,
        -3.69759462e-01, -3.89532592e-01, -3.66222512e-01,
        -3.03922357e-01, -2.56638843e-01, -2.04624160e-01,
        -1.68460967e-01, -1.30618215e-01, -9.46214776e-02,
        -7.39524493e-02],
       [            nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,  5.60126047e-01,
         4.30747953e-01,  2.49933465e-01,  1.39216054e-01,
         1.19039755e-01,  3.13604532e-02, -5.42839263e-02,
        -4.51756769e-02,  4.31317545e-02,  5.12597615e-02,
         3.06493179e-02,  2.90398380e-02,  5.54616912e-02,
         1.12885867e-02, -9.49085158e-02, -1.08302697e-01,
        -1.48894718e-01, -1.19662135e-01, -1.06998496e-01,
        -9.05264126e-02, -5.41810128e-02,  1.15318473e-02,
         5.92560409e-02,  7.65608505e-02,  4.82936548e-02,
        -3.00144229e-02, -8.46386771e-02, -4.25694254e-02,
        -1.26625607e-02, -1.84265031e-02,  8.25125325e-03,
         2.80879201e-02,  6.34160108e-02,  4.03781195e-02,
         6.64401140e-02,  6.21482293e-02,  5.20121263e-02,
         6.87192789e-02,  7.92680672e-02,  6.53106539e-02,
         4.26418458e-02,  3.87619789e-02,  2.10517850e-02,
         7.30233776e-02,  7.78041231e-02,  3.34490800e-02,
         9.17114566e-03,  1.69762694e-02,  1.47479391e-02,
        -1.57289451e-02, -2.92649287e-02, -3.80821094e-02,
        -2.53272571e-02, -4.02810033e-02, -4.99583084e-02,
        -1.97287558e-02,  5.42742963e-04, -1.28224943e-02,
        -7.10470942e-03,  9.27096227e-03,  4.43232798e-03,
        -7.66723000e-03, -9.15881422e-02, -1.38654870e-01,
        -9.59328958e-02, -5.62873371e-02, -5.39179436e-02,
        -2.26333152e-02, -9.88458154e-03,  5.11394854e-03,
        -8.84311902e-03, -7.50911506e-03, -3.09146531e-02,
        -2.25476028e-02, -1.97731300e-02,  2.33100799e-02,
         6.23001553e-02,  4.72835140e-02,  5.20146829e-02,
         3.61631936e-02,  3.78427513e-02,  3.59967377e-02,
         2.06690282e-02])
assert 2, eqObj(tick2, rs2, precision)

tick3=exec ta::macd(close,10,6,3) from tickTB where sym=`tick3
rs3=([nan, nan, nan, nan, nan],
       [nan, nan, nan, nan, nan],
       [nan, nan, nan, nan, nan])
assert 3, eqObj(tick3, rs3,precision)

tick4=exec ta::macd(close,10,6,3) from tickTB where sym=`tick4
rs4=([            nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan, -7.74662394e-02,
        -8.11533566e-02, -1.77793705e-01, -3.34126704e-01,
        -3.10470575e-01, -3.00257483e-01, -3.84665028e-01,
        -4.02582942e-01, -2.95517674e-01, -3.10063028e-01,
        -3.55443402e-01, -2.72071236e-01, -1.74927958e-01,
        -6.12765381e-02,  1.04042418e-02,  2.99369448e-02,
         7.09658260e-02,  1.01646818e-01,  1.34037173e-01,
         1.51198436e-01,  1.14931724e-01,  4.62079707e-02,
         1.29949738e-02,  1.26499769e-02, -6.76318703e-04,
        -1.17591812e-04,  4.59293313e-02,  7.56487366e-02,
         1.28567935e-01,  1.59049652e-01,  1.21848076e-01,
         4.28680343e-02,  1.63021379e-02, -1.35767438e-02,
        -9.78656100e-02, -1.41002448e-01, -2.60705668e-01,
        -4.00235827e-01, -3.99689253e-01, -3.05879476e-01,
        -2.40360543e-01, -2.04129450e-01, -1.83779878e-01,
        -6.88337716e-02, -1.00938838e-01, -9.26397813e-02,
        -9.85616426e-02, -1.70668619e-01, -2.86021080e-01,
        -3.60394799e-01, -3.45657633e-01, -3.05582269e-01,
        -3.28624860e-01, -3.11513395e-01, -2.66629376e-01,
        -3.04469656e-01, -2.88949319e-01, -2.89803702e-01,
        -3.03300228e-01, -3.49457925e-01, -3.62435389e-01,
        -3.54308692e-01, -2.99984846e-01, -1.88237931e-01,
        -1.17308542e-01, -8.53467678e-02, -5.28835609e-02,
         2.08239428e-03,  6.00712048e-02,  8.14895379e-02,
         6.27605358e-02,  1.04658624e-01,  1.57993422e-01,
         1.61215399e-01,  1.24593676e-01,  1.17498193e-01,
         1.03091836e-01,  6.33430898e-02,  3.16279480e-02,
        -4.88096257e-02, -8.70492661e-02, -1.03836107e-01,
        -1.02018749e-01, -8.63063318e-02, -1.99095389e-03,
         4.01149658e-02,  2.41968688e-02, -1.64927656e-02,
        -3.31818887e-02],
       [            nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan, -8.79865820e-02,
        -8.45699693e-02, -1.31181837e-01, -2.32654270e-01,
        -2.71562423e-01, -2.85909953e-01, -3.35287490e-01,
        -3.68935216e-01, -3.32226445e-01, -3.21144736e-01,
        -3.38294069e-01, -3.05182653e-01, -2.40055305e-01,
        -1.50665922e-01, -7.01308400e-02, -2.00969476e-02,
         2.54344392e-02,  6.35406284e-02,  9.87889006e-02,
         1.24993668e-01,  1.19962696e-01,  8.30853333e-02,
         4.80401536e-02,  3.03450653e-02,  1.48343733e-02,
         7.35839073e-03,  2.66438610e-02,  5.11462988e-02,
         8.98571171e-02,  1.24453385e-01,  1.23150730e-01,
         8.30093823e-02,  4.96557601e-02,  1.80395082e-02,
        -3.99130509e-02, -9.04577495e-02, -1.75581709e-01,
        -2.87908768e-01, -3.43799010e-01, -3.24839243e-01,
        -2.82599893e-01, -2.43364671e-01, -2.13572275e-01,
        -1.41203023e-01, -1.21070931e-01, -1.06855356e-01,
        -1.02708499e-01, -1.36688559e-01, -2.11354819e-01,
        -2.85874809e-01, -3.15766221e-01, -3.10674245e-01,
        -3.19649553e-01, -3.15581474e-01, -2.91105425e-01,
        -2.97787540e-01, -2.93368430e-01, -2.91586066e-01,
        -2.97443147e-01, -3.23450536e-01, -3.42942962e-01,
        -3.48625827e-01, -3.24305336e-01, -2.56271633e-01,
        -1.86790088e-01, -1.36068428e-01, -9.44759944e-02,
        -4.61968001e-02,  6.93720236e-03,  4.42133701e-02,
         5.34869530e-02,  7.90727883e-02,  1.18533105e-01,
         1.39874252e-01,  1.32233964e-01,  1.24866079e-01,
         1.13978957e-01,  8.86610235e-02,  6.01444857e-02,
         5.66743001e-03, -4.06909181e-02, -7.22635126e-02,
        -8.71411307e-02, -8.67237312e-02, -4.43573426e-02,
        -2.12118836e-03,  1.10378402e-02, -2.72746268e-03,
        -1.79546757e-02],
       [            nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,  1.05203426e-02,
         3.41661270e-03, -4.66118680e-02, -1.01472433e-01,
        -3.89081523e-02, -1.43475302e-02, -4.93775374e-02,
        -3.36477258e-02,  3.67087711e-02,  1.10817086e-02,
        -1.71493328e-02,  3.31114165e-02,  6.51273473e-02,
         8.93893837e-02,  8.05350818e-02,  5.00338924e-02,
         4.55313868e-02,  3.81061892e-02,  3.52482722e-02,
         2.62047679e-02, -5.03097247e-03, -3.68773627e-02,
        -3.50451798e-02, -1.76950883e-02, -1.55106920e-02,
        -7.47598254e-03,  1.92854703e-02,  2.45024378e-02,
         3.87108182e-02,  3.45962675e-02, -1.30265422e-03,
        -4.01413480e-02, -3.33536222e-02, -3.16162519e-02,
        -5.79525591e-02, -5.05446986e-02, -8.51239592e-02,
        -1.12327059e-01, -5.58902427e-02,  1.89597671e-02,
         4.22393502e-02,  3.92352217e-02,  2.97923965e-02,
         7.23692516e-02,  2.01320926e-02,  1.42155747e-02,
         4.14685667e-03, -3.39800599e-02, -7.46662603e-02,
        -7.45199899e-02, -2.98914117e-02,  5.09197609e-03,
        -8.97530772e-03,  4.06807875e-03,  2.44760492e-02,
        -6.68211572e-03,  4.41911093e-03,  1.78236369e-03,
        -5.85708083e-03, -2.60073893e-02, -1.94924265e-02,
        -5.68286458e-03,  2.43204907e-02,  6.80337029e-02,
         6.94815456e-02,  5.07216601e-02,  4.15924335e-02,
         4.82791943e-02,  5.31340024e-02,  3.72761678e-02,
         9.27358285e-03,  2.55858353e-02,  3.94603167e-02,
         2.13411469e-02, -7.64028780e-03, -7.36788556e-03,
        -1.08871215e-02, -2.53179336e-02, -2.85165377e-02,
        -5.44770557e-02, -4.63583481e-02, -3.15725945e-02,
        -1.48776181e-02,  4.17399478e-04,  4.23663887e-02,
         4.22361542e-02,  1.31590286e-02, -1.37653029e-02,
        -1.52272130e-02])
assert 4, eqObj(tick4, rs4, precision)

tick5=exec ta::macd(close,10,6,3) from tickTB where sym=`tick5
rs5=([            nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan, -1.36022432e-01,
        -8.29422868e-02, -1.16184161e-01, -2.27238027e-01,
        -2.40854545e-01, -2.37339287e-01, -2.14643913e-01,
        -2.82697582e-01, -2.91160242e-01, -2.74746979e-01,
        -2.65427696e-01, -2.98140962e-01, -2.23849184e-01,
        -1.61530656e-01, -1.12563689e-01, -6.35537117e-02,
        -4.61554802e-02, -6.57700831e-03,  2.72845406e-02,
         2.38381970e-02,  5.48714665e-02,  8.15858984e-02,
         2.85444159e-02, -8.19796827e-04,  1.80214623e-03,
         9.47459887e-03,  2.07390401e-02,  5.94915556e-02,
         8.32045033e-02,  9.68962518e-02,  1.09215001e-01,
         9.72342697e-02,  6.95969973e-02,  9.55442018e-02,
         6.83422200e-02,  9.41419316e-03, -3.79808455e-02,
        -1.50978941e-01, -2.79823078e-01, -3.03182738e-01,
        -2.62643177e-01, -2.20112619e-01, -2.08757741e-01,
        -1.63225267e-01, -1.36447834e-01, -1.64619576e-01,
        -1.50713733e-01, -1.68004410e-01, -2.02628603e-01,
        -2.16493204e-01, -1.95687154e-01, -1.32842728e-01,
        -7.36301295e-02, -1.02732890e-01, -9.67418853e-02,
        -6.53579535e-02, -1.00764333e-01, -1.00637447e-01,
        -1.19231478e-01, -1.86241938e-01, -2.64560158e-01,
        -2.92431318e-01, -3.22619330e-01, -3.01684047e-01,
        -2.15595424e-01, -1.58239974e-01, -1.26889906e-01,
        -9.15871448e-02, -4.74965882e-02,  4.78235157e-04,
         4.40750418e-02,  3.60952513e-02,  3.99462697e-02,
         2.24593964e-02,  1.62678784e-02,  7.72589196e-02,
         1.80577896e-01,  2.07682342e-01,  1.81565079e-01,
         2.30636024e-01,  2.82657433e-01,  2.86947480e-01,
         2.11171665e-01,  1.54878180e-01,  8.69207832e-02,
         4.99627834e-02,  2.99243272e-02, -7.23707328e-03,
        -1.71502516e-02],
       [            nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan, -1.55037780e-01,
        -1.18990034e-01, -1.17587097e-01, -1.72412562e-01,
        -2.06633554e-01, -2.21986420e-01, -2.18315167e-01,
        -2.50506375e-01, -2.70833308e-01, -2.72790143e-01,
        -2.69108920e-01, -2.83624941e-01, -2.53737063e-01,
        -2.07633859e-01, -1.60098774e-01, -1.11826243e-01,
        -7.89908616e-02, -4.27839349e-02, -7.74969714e-03,
         8.04424994e-03,  3.14578582e-02,  5.65218783e-02,
         4.25331471e-02,  2.08566751e-02,  1.13294107e-02,
         1.04020048e-02,  1.55705224e-02,  3.75310390e-02,
         6.03677712e-02,  7.86320115e-02,  9.39235062e-02,
         9.55788879e-02,  8.25879426e-02,  8.90660722e-02,
         7.87041461e-02,  4.40591696e-02,  3.03916205e-03,
        -7.39698895e-02, -1.76896484e-01, -2.40039611e-01,
        -2.51341394e-01, -2.35727006e-01, -2.22242374e-01,
        -1.92733820e-01, -1.64590827e-01, -1.64605202e-01,
        -1.57659467e-01, -1.62831939e-01, -1.82730271e-01,
        -1.99611737e-01, -1.97649446e-01, -1.65246087e-01,
        -1.19438108e-01, -1.11085499e-01, -1.03913692e-01,
        -8.46358228e-02, -9.27000782e-02, -9.66687627e-02,
        -1.07950120e-01, -1.47096029e-01, -2.05828094e-01,
        -2.49129706e-01, -2.85874518e-01, -2.93779282e-01,
        -2.54687353e-01, -2.06463663e-01, -1.66676785e-01,
        -1.29131965e-01, -8.83142765e-02, -4.39180207e-02,
         7.85105484e-05,  1.80868809e-02,  2.90165753e-02,
         2.57379859e-02,  2.10029321e-02,  4.91309259e-02,
         1.14854411e-01,  1.61268377e-01,  1.71416728e-01,
         2.01026376e-01,  2.41841904e-01,  2.64394692e-01,
         2.37783179e-01,  1.96330679e-01,  1.41625731e-01,
         9.57942573e-02,  6.28592923e-02,  2.78111095e-02,
         5.33042896e-03],
       [            nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,             nan,
                    nan,             nan,  1.90153483e-02,
         3.60477468e-02,  1.40293632e-03, -5.48254649e-02,
        -3.42209913e-02, -1.53528666e-02,  3.67125349e-03,
        -3.21912079e-02, -2.03269338e-02, -1.95683515e-03,
         3.68122379e-03, -1.45160212e-02,  2.98878782e-02,
         4.61032036e-02,  4.75350850e-02,  4.82725312e-02,
         3.28353813e-02,  3.62069266e-02,  3.50342378e-02,
         1.57939471e-02,  2.34136083e-02,  2.50640201e-02,
        -1.39887312e-02, -2.16764720e-02, -9.52726445e-03,
        -9.27405908e-04,  5.16851765e-03,  2.19605166e-02,
         2.28367322e-02,  1.82642403e-02,  1.52914947e-02,
         1.65538178e-03, -1.29909453e-02,  6.47812960e-03,
        -1.03619261e-02, -3.46449765e-02, -4.10200076e-02,
        -7.70090516e-02, -1.02926594e-01, -6.31431273e-02,
        -1.13017829e-02,  1.56143876e-02,  1.34846327e-02,
         2.95085531e-02,  2.81429933e-02, -1.43744970e-05,
         6.94573418e-03, -5.17247147e-03, -1.98983320e-02,
        -1.68814664e-02,  1.96229138e-03,  3.24033589e-02,
         4.58079788e-02,  8.35260924e-03,  7.17180687e-03,
         1.92778693e-02, -8.06425534e-03, -3.96868458e-03,
        -1.12813574e-02, -3.91459089e-02, -5.87320646e-02,
        -4.33016121e-02, -3.67448119e-02, -7.90476447e-03,
         3.90919289e-02,  4.82236898e-02,  3.97868785e-02,
         3.75448201e-02,  4.08176883e-02,  4.43962558e-02,
         4.39965312e-02,  1.80083704e-02,  1.09296944e-02,
        -3.27858947e-03, -4.73505373e-03,  2.81279938e-02,
         6.57234850e-02,  4.64139656e-02,  1.01483510e-02,
         2.96096484e-02,  4.08155285e-02,  2.25527880e-02,
        -2.66115137e-02, -4.14524994e-02, -5.47049481e-02,
        -4.58314739e-02, -3.29349651e-02, -3.50481828e-02,
        -2.24806805e-02])
assert 5, eqObj(tick5,rs5, 3)

maBySym=(exec ta::macd(close,10,6,3)[0] as rs0, ta::macd(close,10,6,3)[1] as rs1, ta::macd(close,10,6,3)[2] as rs2  from tickTB context by sym ).values()
rs00=rs1[0].join(rs2[0]).join(rs3[0]).join(rs4[0]).join(rs5[0])
rs01=rs1[1].join(rs2[1]).join(rs3[1]).join(rs4[1]).join(rs5[1])
rs02=rs1[2].join(rs2[2]).join(rs3[2]).join(rs4[2]).join(rs5[2])
assert 6, eqObj(maBySym, (rs00,rs01,rs02), 3)