#include "setup/settings.txt"
use ta
//sar(inHigh, inLow, acceleration, maximum)
/*
acceleration = 0.02
maximum = 0.2
@testing:case="test_ta_function_sar_use_ticks_specify_ac_0.02_maxium_0.2"
tickTB=loadText(DATA_DIR+"/ticks1.csv")

tick1=exec sar(high, low, acceleration, maximum) from tickTB where sym=`tick1
rs1 = [,13.12,12.26,12.26,13.22,12.01,12.01,12.1228]
assert 1, eqObj(tick1, rs1, precision)

tick2=exec sar(high, low, acceleration, maximum) from tickTB where sym=`tick2
rs2 = array(DOUBLE, size(tick2), size(tick2), NULL)
assert 2, eqObj(tick2, rs2, precision)

tick3=exec sar(high, low, acceleration, maximum) from tickTB where sym=`tick3
rs3 = [,26.5,25.6,26.88,26.9]
assert 3, eqObj(tick3, rs3, precision)

tick4=exec sar(high, low, acceleration, maximum) from tickTB where sym=`tick4
rs4 = [, 10.91, 10.937, 10.96346, 11.016922, 11.068245, 11.1, 11.52, 11, 11, 11.0492, 12.19, 12.21, 12.19, 11.6, 11.6, 9.43, 10, 10.62, 8.68, 8.68, 9.31, 10.2, 8.39, 9.1, 9.1748, 9.246608, 9.315544, 9.381722, 9.445253, 9.559538, 9.666966, 9.767948, 10.62, 10.94, 10.62, 10.48, 9.82, 10.15, 10.1828, 10.248632, 10.335942, 10.86, 11.25, 10.16, 10.41, 10.88, 10.41, 10, 9.89, 7.96, 8.05, 8.05, 8.12, 8.1872, 8.291768, 9.27, 9.97, 9.27, 9.1, 9.08, 8.48, 6.99, 7.11, 7.35, 7.87, 7.65, 7.65, 7.45, 7.06, 7.06, 6.87, 6.5, 6.5, 5.46, 5.73, 5.786, 5.83976, 5.89137, 5.940915, 6.02606, 6.106096, 6.181331, 6.283624, 6.449262, 6.598336, 6.732502, 6.853252, 6.961927, 7.059734, 7.29, 7.31, 7.29, 6.01, 6.4, 6.4252, 6.45, 6.5118, 7.13, 7.4]
assert 4, eqObj(tick4, rs4, precision)

tick5=exec sar(high, low, acceleration, maximum) from tickTB where sym=`tick5
rs5 = [,9.41,9.4358,9.461084,9.485862,9.510145,9.533942,10,10.2,9.5,10,9.28,9.28,9.17,10.35,8.02,8.02,8.92,9.1, 8.48,8.48,8.46,7.31,7.8,7.838,7.87448,7.909501,7.962931, 8.138547,8.246721,8.40118,8.75,9.19,8.21,8.4,8.4208,8.465752,8.531692,8.592357,8.697121,9.19,8.76,8.76,9.17,9.75,9.17,8.85, 7.91,6.98,7,7.0232,7.045936,7.068217,7.54,7.71,7.54,7.49,7.34,6.51,6.78,6.78,7.13,7.59,7.4,7.4,7.16,6.92,6.89,6.75,6.06,6,5.07,5.24,5.284,5.32624,5.36679, 5.471976,5.564618,5.687156,5.79744,5.896696,5.98,5.98,6.2068,6.512912,6.770046,6.86,7.05,7.88,8.8,7.88,7.85,6.93,7.25,7.67]
assert 5, eqObj(tick5, rs5, precision)

sarBySym = (exec sar(high, low, acceleration, maximum) from tickTB context by sym).values()[0]
rs=rs1.join(rs2).join(rs3).join(rs4).join(rs5)
assert 6, eqObj(sarBySym, rs, precision)

@testing:case="test_ta_function_sar_use_ticks_take40"
low = 1..40
tick1 = sar(low + 10, low, acceleration, maximum)
rs1 = [, 1, 1.22, 1.6912, 2.429728, 3.43535, 4.691815, 6, 7, 8, 9, 10, 11, 12, 13, 14,15, 16,17, 18, 20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]
assert 1, eqObj(tick1, rs1, precision)

@testing:case="test_ta_function_sar_use_ticks_rand40"
low = [0.52290704, 0.12353979, 0.77053422, 0.12841879, 0.6048718, 0.80904399, 0.98889824, 0.81747543, 0.40124982, 0.11478289, 0.05932425, 0.37722342, 0.94529224, 0.06293823, 0.13265079, 0.23754467, 0.52132564, 0.93052345, 0.57823216, 0.08296149, 0.97269271, 0.26349627, 0.40093066, 0.839212, 0.39459552, 0.38523354, 0.05101728, 0.70090589, 0.65537806, 0.65402787, 0.95740971, 0.77673239, 0.9058046, 0.14841775, 0.88522706, 0.01148273, 0.40028599, 0.09602881, 0.95931427, 0.16892637]
high = [0.48387944, 0.59616651, 0.8249145, 0.69994475, 0.51918179, 0.91682667, 0.29872429, 0.45897201, 0.67986442, 0.74015686, 0.94504135, 0.62549517, 0.27356778, 0.86411114, 0.69301487, 0.29699291, 0.31542305, 0.70869287, 0.297522, , 0.3390045, 0.64130013, 0.33398494, 0.59193906, 0.83482875, 0.73869972, 0.08560472, 0.83252824, 0.45392507, 0.53627704, 0.91615475, 0.61106442, 0.84909903, 0.57068291, 0.88473555, 0.68872693, 0.68147652, 0.1245154, 0.09046706, 0.8657031]
tick1 = sar(high, low, acceleration, maximum)
rs1 = [,0.596167,0.12354,0.12354,0.128419,0.128419,0.159955,0.19023,0.219294,0.679864,0.059324,0.059324,0.059324,0.273568,0.864111,0.864111,0.693015,0.062938,0.521326,,0.082961,0.082961,0.105295,0.126735,0.147318,0.188568,0.085605,0.051017,0.051017,0.066647,0.115333, 0.147366,0.570683,0.148418,0.688727,0.884736,0.688727,0.681477,0.011483]
assert 1, eqObj(tick1, rs1, precision)
*/