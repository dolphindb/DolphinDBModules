#include "setup/settings.txt"
use ta

@testing:case="test_ta_function_rsi_period=14"
close = [100.243874,99.677051,100.676061,98.729214,99.811684,101.812203,99.706868,98.214068,99.034305,101.39895,99.739858,98.857177,100.976889,98.488709,99.175023,99.511593,99.997514,99.617737,100.372465,100.106315,100.600162,100.382803,100.136037,100.630854,99.995787,99.57589,102.56802,100.004189,99.821923,102.296099,100.156529,100.320803,101.438503,100.210978,98.201,99.909849,99.709805,100.728769,100.236768,99.456067]
out = [47.4808676, 48.36310213, 49.67743163, 48.63548602, 50.84209687, 50.02593099, 51.57916846, 50.83033369, 49.9438193 , 51.76062497, 49.28803617, 47.66669165, 58.21487883, 49.085407, 48.50306013, 56.1143983, 49.32505503, 49.82699363, 53.22199613, 49.2781989, 43.58326343, 48.98157668, 48.39775282, 51.56461958, 49.96998127, 47.46180498]
assert 1, eqObj(rsi(close, 14)[14:], out, 6)

@testing:case="test_ta_function_rsi_period=14_starting_NULL"
close = [NULL,NULL,NULL,100.243874,99.677051,100.676061,98.729214,99.811684,101.812203,99.706868,98.214068,99.034305,101.39895,99.739858,98.857177,100.976889,98.488709,99.175023,99.511593,99.997514,99.617737,100.372465,100.106315,100.600162,100.382803,100.136037,100.630854,99.995787,99.57589,102.56802,100.004189,99.821923,102.296099,100.156529,100.320803,101.438503,100.210978,98.201,99.909849,99.709805,100.728769,100.236768,99.456067]
out = [47.4808676, 48.36310213, 49.67743163, 48.63548602, 50.84209687, 50.02593099, 51.57916846, 50.83033369, 49.9438193 , 51.76062497, 49.28803617, 47.66669165, 58.21487883, 49.085407, 48.50306013, 56.1143983, 49.32505503, 49.82699363, 53.22199613, 49.2781989, 43.58326343, 48.98157668, 48.39775282, 51.56461958, 49.96998127, 47.46180498]
assert 1, eqObj(rsi(close, 14)[17:], out, 6)

@testing:case="test_ta_function_rsi_period=2"
close = [100.243874,99.677051,100.676061,98.729214,99.811684,101.812203,99.706868,98.214068,99.034305,101.39895,99.739858,98.857177,100.976889,98.488709,99.175023,99.511593,99.997514,99.617737,100.372465,100.106315,100.600162,100.382803,100.136037,100.630854,99.995787,99.57589,102.56802,100.004189,99.821923,102.296099,100.156529,100.320803,101.438503,100.210978,98.201,99.909849,99.709805,100.728769,100.236768,99.456067]
out = [63.80054578, 18.29847164, 54.43526865, 82.70685717, 35.86655971, 19.89122293, 46.21666833, 81.42039646, 42.43978503, 28.11655763, 72.57356197, 29.59852214, 46.93368235, 57.25650861, 72.63005021, 46.49192441, 77.98361301, 55.10857586, 78.5060928 , 53.81559927, 31.3956816 , 74.31284927, 28.51852769, 15.71360811, 88.60852848, 35.69895612, 32.90531246, 78.52672412, 36.08768629, 40.98525889, 71.11023688, 33.52284501, 12.27486329, 57.7788402 , 51.52181002, 76.95050718, 51.0775958 , 24.71044725]
assert 1, eqObj(rsi(close, 2)[2:], out, 6)

@testing:case="test_ta_function_rsi_context_by"
timePeriod = 10
precision = 6
tickTB = loadText(DATA_DIR+"/ticks1.csv")

res = (exec sym, rsi(close, timePeriod) as rsi from tickTB context by sym).rsi
out = [00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,56.837607,54.579208,55.481386,51.352801,51.063055,54.524874,49.951953,45.85179,48.09418,54.836542,54.246658,53.376689,54.981092,58.861086,54.424047,44.779603,44.725242,38.62905,39.180138,36.236159,34.230642,34.178097,40.103297,43.695857,44.984074,41.271535,32.933657,28.413747,34.414508,34.003956,30.743848,33.64694,34.18009,40.549281,36.173752,44.223394,43.658662,43.791584,50.761499,55.113502,55.458838,54.988774,58.862929,57.578093,70.611389,72.448348,65.695668,66.720317,71.15827,72.591602,66.287756,66.599636,65.477874,68.75269,61.155729,57.719841,64.736561,67.334876,60.980791,63.825478,67.910306,66.395679,63.762144,38.386168,30.986894,38.032513,38.195554,32.987939,36.716162,34.86862,35.270737,30.28471,29.418314,23.925626,23.773872,21.638872,34.087974,42.345013,37.706787,42.495295,39.87543,43.729971,44.907289,42.132147,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,59.580838,49.257426,49.870185,37.818608,29.163604,42.29895,40.607816,32.788425,34.304255,45.789443,38.61175,35.107778,44.724815,47.93955,52.241516,52.43141,50.107046,53.38708,54.495064,56.669432,57.266491,51.438726,45.835719,47.271591,50.358449,48.371236,49.837517,57.256083,58.039612,63.664156,64.499015,54.13406,45.322221,49.255591,46.9333,37.191623,37.413686,27.013813,21.574344,32.681976,43.273385,42.739703,41.160427,39.874135,53.176553,41.857856,44.635334,43.004886,36.074562,30.081353,28.67433,34.805414,36.868212,31.721149,33.941322,37.088473,30.386349,34.091698,31.933317,29.591482,25.577564,25.284428,25.045232,32.174591,44.333005,43.770544,41.572867,43.465238,49.878521,54.371634,52.489477,47.240376,57.133041,61.974381,57.798423,51.870946,55.377626,54.495287,49.066268,48.003537,37.527345,39.056112,39.331043,41.102376,43.83541,59.580944,57.729795,48.821296,43.03759,44.547763,00F,00F,00F,00F,00F,00F,00F,00F,00F,00F,39.111111,39.706601,48.873531,36.531022,26.100261,34.500736,34.386442,36.263297,26.790544,30.421107,31.829716,30.242399,25.246329,41.38506,42.668641,43.454835,46.317659,43.850855,49.410549,51.464325,47.011141,53.966095,56.100166,43.477478,44.153054,48.485857,49.851027,51.516578,58.514947,59.330293,60.199448,62.218048,57.534769,52.471165,63.065629,52.439244,43.786204,41.389797,29.031703,22.885514,31.425325,39.123987,40.133155,36.873094,42.692077,41.434658,34.516067,39.339339,34.977372,31.140806,30.673516,35.260946,44.604608,47.822825,37.369797,41.110375,45.767776,37.52423,40.757724,37.455055,30.331061,26.023062,27.003477,24.4801,29.936113,42.289713,41.706095,40.166334,42.524081,46.722854,50.927357,54.104514,47.299304,49.645078,45.794798,47.134677,60.72591,70.085154,64.401028,57.627453,66.807745,70.238607,67.722267,55.476245,55.29412,50.504268,51.754476,52.515996,47.705216,50.132731]
assert 1, eqObj(res, out, precision)
