#include "setup/settings.txt"
use ta

precision=5
nan=double()
@testing:case="test_ta_function_tema_use_ticksxtby"
tickTB=loadText(DATA_DIR+"/ticks1.csv")

tick1=exec ta::tema(close,10) from tickTB where sym=`tick1
rs1=[nan, nan, nan, nan, nan, nan, nan, nan]
assert 1, eqObj(tick1, rs1, precision)

tick2=exec ta::tema(close,10) from tickTB where sym=`tick2
rs2=[        nan,         nan,         nan,         nan,         nan,
               nan,         nan,         nan,         nan,         nan,
               nan,         nan,         nan,         nan,         nan,
               nan,         nan,         nan,         nan,         nan,
               nan,         nan,         nan,         nan,         nan,
               nan,         nan,         nan,         nan,         nan,
               nan,         nan,         nan, 14.31481438, 13.77153414,
       13.17461009, 12.62589038, 12.29217092, 12.37246292, 12.63227468,
       12.89631899, 12.8881964 , 12.32660045, 11.5645464 , 11.32822333,
       11.17252052, 10.84824787, 10.76842467, 10.76542774, 11.00939591,
       10.95141224, 11.2249176 , 11.39458341, 11.52055505, 11.85304043,
       12.24643934, 12.51573619, 12.66963506, 12.89301966, 12.99371331,
       13.62182102, 14.13256569, 14.27713112, 14.39154531, 14.66810475,
       14.90409182, 14.89054883, 14.86569042, 14.80097411, 14.86279639,
       14.73618358, 14.56344638, 14.66758766, 14.82801994, 14.79912227,
       14.86554963, 15.05112198, 15.13915964, 15.14290847, 14.45774318,
       13.63092413, 13.28353258, 13.07589447, 12.71569371, 12.59508692,
       12.45971957, 12.40416018, 12.17452989, 12.00440611, 11.6213292 ,
       11.3824472 , 11.12448845, 11.22085002, 11.50677942, 11.5465427 ,
       11.70564483, 11.73273872, 11.84917985, 11.9595455 , 11.95889101]
assert 2, eqObj(tick2, rs2, precision)

tick3=exec ta::tema(close,10) from tickTB where sym=`tick3
rs3=[nan, nan, nan, nan, nan]
assert 3, eqObj(tick3, rs3,precision)

tick4=exec ta::tema(close,10) from tickTB where sym=`tick4
rs4=[        nan,         nan,         nan,         nan,         nan,
               nan,         nan,         nan,         nan,         nan,
               nan,         nan,         nan,         nan,         nan,
               nan,         nan,         nan,         nan,         nan,
               nan,         nan,         nan,         nan,         nan,
               nan,         nan, 10.4438084 , 10.62532777, 10.82372975,
       10.96760353, 10.88318186, 10.63326062, 10.49833231, 10.48966612,
       10.42690002, 10.41927054, 10.612126  , 10.76124387, 11.02773791,
       11.22507494, 11.14246669, 10.8547816 , 10.7508923 , 10.6202796 ,
       10.23892871,  9.99276726,  9.3941683 ,  8.64737791,  8.439819  ,
        8.64800617,  8.79164423,  8.84528118,  8.84808798,  9.27113108,
        9.11503835,  9.11076864,  9.04573869,  8.68646632,  8.0969018 ,
        7.62247724,  7.49901471,  7.49960993,  7.25106328,  7.16529535,
        7.21109196,  6.92180924,  6.84207535,  6.69960188,  6.5008797 ,
        6.15181898,  5.92134557,  5.7768183 ,  5.83916205,  6.18224496,
        6.40836563,  6.49953334,  6.60492161,  6.82129589,  7.0769632 ,
        7.20097874,  7.15715975,  7.36292329,  7.640057  ,  7.72653774,
        7.63845043,  7.65674209,  7.63964268,  7.50510249,  7.38486095,
        7.0375066 ,  6.83220169,  6.70405066,  6.65248737,  6.66650928,
        6.99072879,  7.17957546,  7.13741565,  6.97575735,  6.89440851]
assert 4, eqObj(tick4, rs4, precision)

tick5=exec ta::tema(close,10) from tickTB where sym=`tick5
rs5=[       nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan, 8.44685396, 8.60183877, 8.74976413,
       8.74997815, 8.89448502, 9.03507815, 8.84089852, 8.71788967,
       8.71813356, 8.74333455, 8.78968034, 8.96280375, 9.0924682 ,
       9.19092124, 9.28985433, 9.28876855, 9.2118466 , 9.35265838,
       9.27755165, 9.04918223, 8.83921169, 8.32001175, 7.67242628,
       7.41846024, 7.43818386, 7.49577852, 7.4444181 , 7.54860553,
       7.59612866, 7.41728816, 7.40330724, 7.26012869, 7.03041568,
       6.87117581, 6.85572056, 7.0356117 , 7.23444743, 7.07946654,
       7.05735548, 7.14745188, 6.96291902, 6.9113822 , 6.77825358,
       6.42393524, 5.98366809, 5.72203727, 5.4392485 , 5.3662008 ,
       5.59216525, 5.74281088, 5.8104777 , 5.90956095, 6.0631389 ,
       6.25457295, 6.44969909, 6.44028677, 6.47359496, 6.41355284,
       6.39119974, 6.6574557 , 7.14214191, 7.35100162, 7.33899487,
       7.63611596, 7.97204941, 8.12695319, 7.93276976, 7.77932151,
       7.54527325, 7.41157811, 7.33575933, 7.17903955, 7.12438615]
assert 5, eqObj(tick5,rs5, 3)

maBySym=(exec ta::tema(close,10) from tickTB context by sym ).values()[0]
rs=rs1.join(rs2).join(rs3).join(rs4).join(rs5)
assert 6, eqObj(maBySym, rs, 3)

@testing:case="test_ta_function_tema"
x=[89.79,11.58,99.9,81.11,84.69,31.38,60.9,83.3,97.26,98.67]
validate=[,,,,,, 56.95777778,  80.35175347,97.5800434 , 101.38222222]
assert 1,eqObj(ta::tema(x,3),validate,6)

validate=[,,, 86.84333333, 85.13555556,33.27469136, 57.6837037 , 82.80012346, 97.95128487, 99.56101052]
assert 2,eqObj(ta::tema(x,2),validate,6)
